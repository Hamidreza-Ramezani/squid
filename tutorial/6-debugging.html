<html><head><title>Squid: Debugging Quasiquotes and Rewritings</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Lionel Parreaux (@lptk)" /><meta name="description" content="Squid ― type-safe metaprogramming for Scala" /><meta name="og:image" content="/squid/img/poster.png" /><meta name="og:title" content="Squid: Debugging Quasiquotes and Rewritings" /><meta name="og:site_name" content="Squid" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Squid ― type-safe metaprogramming for Scala" /><link rel="icon" type="image/png" href="/squid/img/favicon.png" /><meta name="twitter:title" content="Squid: Debugging Quasiquotes and Rewritings" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Squid ― type-safe metaprogramming for Scala" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/squid/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/squid/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/squid/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/squid/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/squid/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/squid/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/squid/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/squid/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/squid/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/squid/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/squid/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/squid/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/squid/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/squid/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/squid/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/squid/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/squid/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/squid/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/squid/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/squid/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/squid/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/squid/css/style.css" /><link rel="stylesheet" href="/squid/css/palette.css" /><link rel="stylesheet" href="/squid/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/squid/" class="brand"><div class="brand-wrapper"><span>Squid</span></div></a></li> <li><a href="/squid/tutorial" class="">Squid Tutorial</a> <ul class="sub_section"> <li><a href="/squid/tutorial/0-getting-started.html" class="">»  Getting Started</a></li> <li><a href="/squid/tutorial/1-basics.html" class="">»  Basic Concepts</a></li> <li><a href="/squid/tutorial/2-staging.html" class="">»  Multi-Stage Programming</a></li> <li><a href="/squid/tutorial/3-matching.html" class="">»  Code Pattern Matching</a></li> <li><a href="/squid/tutorial/4-rewriting.html" class="">»  Code Rewriting</a></li> <li><a href="/squid/tutorial/5-advanced.html" class="">»  Advanced Topics on Quasiquotes and Rewriting</a></li> <li><a href="/squid/tutorial/6-debugging.html" class="">»  Debugging Quasiquotes and Rewritings</a></li></ul></li> </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/epfldata/squid"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/epfldata/squid"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Squid Squid ― type-safe metaprogramming for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Squid Squid ― type-safe metaprogramming for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="epfldata" data-github-repo="squid"><div class="content-wrapper"><section><h1 id="debugging-quasiquotes-and-rewritings">Debugging Quasiquotes and Rewritings</h1>

<h2 id="debugging-quasiquotes">Debugging Quasiquotes</h2>

<p>Replace <code class="highlighter-rouge">code"..."</code> with <code class="highlighter-rouge">dbg_code"..."</code> and look at the compilation messages.
They may help you figure out whether the quasiquote was compiled as expected
(sometimes, you may notice that the wrong types or implicit arguments may have been inferred).
Similarly, there is <code class="highlighter-rouge">dbg_rewrite</code> for debugging code rewritings.</p>

<h2 id="debugging-rewritings">Debugging Rewritings</h2>

<p>To see why rewritings did not fire or how they fired,
consider adding printing statements in the right-hand side of the rewriting,
or using <code class="highlighter-rouge">IR.debugFor(... code ...)</code>
to print detailed logging information about what happens in a limited scope.</p>

<p>See also the next section:</p>

<h2 id="debugging-pattern-matching">Debugging Pattern Matching</h2>

<p>When something doesn’t match (for example, in a rewrite rule pattern),
it is usually best to isolate the failure and reproduced it
with a minimal pattern matching example enclosed in <code class="highlighter-rouge">IR.debugFor(... code ...)</code>.</p>

<p>For example, the following session uses logging info to pintpoint that the match failed because
mehod symbol <code class="highlighter-rouge">scala.Int.toFloat</code> is different from <code class="highlighter-rouge">scala.Int.toDouble</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">pgrm</span> <span class="k">=</span> <span class="n">code</span><span class="s">"Some(123.toDouble.toString)"</span>
<span class="n">pgrm</span><span class="k">:</span> <span class="kt">example.doc.IR.ClosedCode</span><span class="o">[</span><span class="kt">Some</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="n">code</span><span class="s">"scala.Some.apply[java.lang.String](123.toDouble.toString())"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nc">IR</span><span class="o">.</span><span class="n">debugFor</span><span class="o">(</span><span class="n">pgrm</span> <span class="k">match</span> <span class="o">{</span> <span class="k">case</span> <span class="n">code</span><span class="s">"Some(123.toFloat.toString)"</span> <span class="k">=&gt;</span> <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">})</span>
<span class="nc">Extracting</span> <span class="n">code</span><span class="s">"scala.Some.apply[java.lang.String](123.toDouble.toString())"</span> <span class="k">with</span> <span class="n">code</span><span class="s">"scala.Some.apply[java.lang.String](123.toFloat.toString())"</span>
<span class="o">|</span> <span class="n">M</span>  <span class="n">scala</span><span class="o">.</span><span class="nc">Some</span><span class="o">.</span><span class="n">apply</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="mf">123.</span><span class="n">toFloat</span><span class="o">.</span><span class="n">toString</span><span class="o">())</span>
<span class="o">|</span> <span class="o">&lt;&lt;</span> <span class="n">code</span><span class="s">"scala.Some.apply[java.lang.String](123.toDouble.toString())"</span>
<span class="o">|</span> <span class="o">|</span> <span class="n">M</span>  <span class="n">scala</span><span class="o">.</span><span class="nc">Some</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">&lt;&lt;</span> <span class="n">code</span><span class="s">"scala.Some"</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">&gt;&gt;</span> <span class="nc">Some</span><span class="o">((</span><span class="nc">Map</span><span class="o">(),</span><span class="nc">Map</span><span class="o">(),</span><span class="nc">Map</span><span class="o">()))</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">[</span><span class="kt">+</span><span class="o">]</span> <span class="nc">Match</span> <span class="nc">String</span> <span class="k">with</span> <span class="nc">String</span>
<span class="o">|</span> <span class="o">|</span> <span class="n">M</span>  <span class="mf">123.</span><span class="n">toFloat</span><span class="o">.</span><span class="n">toString</span><span class="o">()</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">&lt;&lt;</span> <span class="n">code</span><span class="s">"123.toDouble.toString()"</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="n">M</span>  <span class="mf">123.</span><span class="n">toFloat</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">&lt;&lt;</span> <span class="n">code</span><span class="s">"123.toDouble"</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="nc">Symbol</span><span class="k">:</span> <span class="kt">scala.Int.toFloat</span> <span class="o">=/=</span> <span class="n">scala</span><span class="o">.</span><span class="nc">Int</span><span class="o">.</span><span class="n">toDouble</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">&gt;&gt;</span> <span class="nc">None</span>
<span class="o">|</span> <span class="o">|</span> <span class="o">&gt;&gt;</span> <span class="nc">None</span>
<span class="o">|</span> <span class="o">&gt;&gt;</span> <span class="nc">None</span>
<span class="nc">Result</span><span class="k">:</span> <span class="kt">None</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/squid/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'epfldata/squid'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/squid/js/main.js"></script></body></html>